### **Description**

This Cornerstone theme modification introduces recommendations flow to UX.
Below you could find description of consecutive steps happening in browser during the period user lands on product page
and see products in "Related products" section.

### **Theme modifications**

JavaScript code for running recommendations flow resides in `/assets/js/theme/product/recommendations` folder.
In order execute recommendations flow `applyRecommendations()` method from `recommendations.js` is invoked.

Changes made to the theme files except `/assets/js/theme/product/recommendations` folder:
1. Overlay block added to `/templates/components/products/tabs.html` in order to show spinner while
recommendations are being loaded.
Also, "recommendations" class added to "Related products" tab element and css is slightly overridden
for it in `/assets/scss/recommendations.scss`.

2. Some data is injected inside `templates/pages/product.html` in order to be accessible in js context
inside `/assets/js/theme/product.js`.

3. `/assets/js/theme/product.js` is tweaked to invoke recommendations flow inside `onReady()` method.

### **Algorithm**

1. User goes to product detail view and browser sends request for a product page.
`/templates/pages/product.html` is rendered server-side with some related products markup inside.

2. Entry point of recommendations flow: `/assets/js/theme/product.js: 66`.

3. Spinner is laid over currently rendered related products.
`/assets/js/theme/product/recommendations/recommendations.js: 91`

4. Http request to BC GraphQL API is made (`/assets/js/theme/product/recommendations/recommendations.js: 93`).
Response should contain recommendation token along with products generated by Google Retail AI. Products already hydrated, so you don't need to fetch them separatelly.
Service config ID is located in `/assets/js/theme/product/recommendations/constants.js`.
        
        Please, modify `SERVICE_CONFIG_ID` constant to match a service config ID of your prepared one in Google Console Retail AI
        Then the theme should be rebuilt by Stencil and uploaded to the store.

5. If GraphQL request is successful, markup for product cards elements is generated applying received data.
Recommendation token (from p. 4) is attached to "Add To Cart" or "Detailed Product View" links
in each generated product card.
Finally, elements are inserted to DOM.
`/assets/js/theme/product/recommendations/recommendations-carousel.js: 100`

6. Spinner is hidden and newly generated recommended products are shown.
In case of error at steps 4-5, spinner is hidden and initial related products are shown.
